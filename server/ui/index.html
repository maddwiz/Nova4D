<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nova4D Studio</title>
  <link rel="stylesheet" href="/nova4d/studio/assets/styles.css" />
</head>
<body>
  <main class="shell">
    <header class="hero">
      <div>
        <h1>Nova4D Studio</h1>
        <p>Connect your AI, speak or type intent, then run commands directly in Cinema 4D.</p>
      </div>
      <div class="health" id="healthBadge">Checking bridge...</div>
    </header>

    <section class="grid">
      <article class="card">
        <h2>Bridge Connection</h2>
        <label>
          Nova4D API key
          <input id="bridgeApiKey" type="password" placeholder="optional" autocomplete="off" />
        </label>
        <div class="inline-actions">
          <button id="refreshButton" class="secondary">Refresh Status</button>
          <button id="loadRecentButton" class="secondary">Load Recent</button>
        </div>
        <label class="toggle-row">
          <input id="liveStreamEnabled" type="checkbox" checked />
          <span>Live command stream</span>
        </label>
        <div id="streamStatus" class="hint">Live stream offline.</div>
        <div class="inline-actions">
          <button id="preflightButton" class="secondary">Run Preflight</button>
          <button id="preflightProbeButton" class="secondary">Preflight + Worker Probe</button>
        </div>
        <div id="preflightSummary" class="hint">Preflight not run in this session.</div>
        <ul id="preflightChecks" class="event-feed"></ul>
        <div class="inline-actions">
          <button id="systemStatusButton" class="secondary">Refresh System Status</button>
        </div>
        <div id="systemStatusSummary" class="hint">System status not loaded.</div>
        <ul id="systemStatusList" class="event-feed"></ul>
        <pre id="bridgeInfo" class="mono small">-</pre>
      </article>

      <article class="card">
        <h2>AI Provider</h2>
        <label>
          Provider
          <select id="providerKind">
            <option value="builtin">Builtin (No API key)</option>
            <option value="openai">OpenAI</option>
            <option value="openrouter">OpenRouter</option>
            <option value="anthropic">Anthropic</option>
            <option value="openai-compatible">OpenAI-Compatible (local/self-hosted)</option>
          </select>
        </label>
        <label>
          Base URL
          <input id="providerBaseUrl" type="text" placeholder="https://api.openai.com" autocomplete="off" />
        </label>
        <label>
          Model
          <input id="providerModel" type="text" placeholder="gpt-4o-mini" autocomplete="off" />
        </label>
        <label>
          Provider API key
          <input id="providerApiKey" type="password" placeholder="only used for plan/run calls" autocomplete="off" />
        </label>
        <label>
          Max commands per run
          <input id="maxCommands" type="number" min="1" max="30" value="10" />
        </label>
        <label>
          Safety mode
          <select id="safetyMode">
            <option value="balanced">Balanced (recommended)</option>
            <option value="strict">Strict (safe-only)</option>
            <option value="unrestricted">Unrestricted</option>
          </select>
        </label>
        <label class="toggle-row">
          <input id="allowDangerous" type="checkbox" />
          <span>Allow dangerous commands</span>
        </label>
        <label class="toggle-row">
          <input id="useSceneContext" type="checkbox" checked />
          <span>Use live scene context</span>
        </label>
        <label class="toggle-row">
          <input id="refreshSceneContext" type="checkbox" checked />
          <span>Refresh scene context each request</span>
        </label>
        <div class="inline-actions">
          <button id="providerTestButton" class="secondary">Test Provider</button>
        </div>
        <div id="providerStatus" class="hint">Provider not tested in this session.</div>

        <h3>Saved Provider Profiles</h3>
        <label>
          Saved profile
          <select id="providerProfileSelect">
            <option value="">No saved profiles</option>
          </select>
        </label>
        <label>
          Profile name
          <input id="providerProfileName" type="text" placeholder="e.g. OpenAI GPT-4o Mini" autocomplete="off" />
        </label>
        <label class="toggle-row">
          <input id="providerProfileRememberKey" type="checkbox" />
          <span>Remember provider API key in this browser</span>
        </label>
        <div class="inline-actions">
          <button id="providerProfileApplyButton" class="secondary">Apply Profile</button>
          <button id="providerProfileSaveButton" class="secondary">Save Profile</button>
          <button id="providerProfileDeleteButton" class="secondary">Delete Profile</button>
        </div>
        <div id="providerProfileStatus" class="hint">No provider profiles saved yet.</div>
      </article>
    </section>

    <section class="card">
      <h2>Quick Start Checklist</h2>
      <p class="hint">Run one guided check for bridge, local readiness, worker response, and provider setup.</p>
      <div class="inline-actions">
        <button id="guidedCheckButton" class="secondary">Run Guided Check</button>
      </div>
      <div id="guidedCheckSummary" class="hint">Checklist not run in this session.</div>
      <ol id="guidedCheckList" class="plan-list">
        <li class="hint">Run guided check to populate readiness results.</li>
      </ol>
    </section>

    <section class="card">
      <h2>Prompt (Text or Voice)</h2>
      <div class="template-row">
        <label>
          Quick workflow
          <select id="templateSelect"></select>
        </label>
      </div>
      <label class="toggle-row">
        <input id="deterministicWorkflow" type="checkbox" checked />
        <span>Run template as deterministic workflow (no AI planner)</span>
      </label>
      <div class="grid workflow-grid">
        <label>
          Object Name
          <input id="workflowObjectName" type="text" value="WorkflowCube" autocomplete="off" />
        </label>
        <label>
          Cloner Name
          <input id="workflowClonerName" type="text" value="WorkflowCloner" autocomplete="off" />
        </label>
        <label>
          Material Name
          <input id="workflowMaterialName" type="text" value="WorkflowRedshiftMat" autocomplete="off" />
        </label>
        <label>
          Render Output
          <input id="workflowRenderOutput" type="text" value="/tmp/nova4d-workflow-frame.png" autocomplete="off" />
        </label>
        <label>
          Frame Start
          <input id="workflowFrameStart" type="number" value="0" />
        </label>
        <label>
          Frame End
          <input id="workflowFrameEnd" type="number" value="30" />
        </label>
        <label>
          Start Value
          <input id="workflowStartValue" type="number" value="0" step="0.01" />
        </label>
        <label>
          End Value
          <input id="workflowEndValue" type="number" value="180" step="0.01" />
        </label>
        <label>
          Render Frame
          <input id="workflowRenderFrame" type="number" value="0" />
        </label>
      </div>
      <div class="inline-actions">
        <button id="loadTemplateButton" class="secondary">Load Template</button>
        <button id="previewTemplateButton" class="secondary">Preview Template</button>
        <button id="runTemplateButton" class="secondary">Run Template</button>
      </div>
      <textarea id="promptInput" rows="5" placeholder="Example: Build a sci-fi cube field using a cloner, create a redshift material, animate x from frame 0 to 60, and render frame 30."></textarea>
      <h3>Saved Prompt Presets</h3>
      <div class="inline-actions wrap">
        <select id="promptPresetSelect">
          <option value="">No saved presets</option>
        </select>
        <input id="promptPresetName" type="text" placeholder="Preset name" autocomplete="off" />
      </div>
      <div class="inline-actions">
        <button id="promptPresetLoadButton" class="secondary">Load Preset</button>
        <button id="promptPresetSaveButton" class="secondary">Save Preset</button>
        <button id="promptPresetDeleteButton" class="secondary">Delete Preset</button>
      </div>
      <div id="promptPresetStatus" class="hint">No prompt presets saved yet.</div>
      <div class="inline-actions wrap">
        <button id="voiceStart" class="secondary">Start Voice</button>
        <button id="voiceStop" class="secondary">Stop Voice</button>
        <button id="snapshotButton" class="secondary">Scene Snapshot</button>
        <button id="planButton" class="secondary">Plan Only</button>
        <button id="queuePlanButton" class="secondary">Queue Last Plan</button>
        <button id="smartRunButton" class="secondary">Smart Run</button>
        <button id="runButton">Run In Cinema 4D</button>
      </div>
      <label class="toggle-row">
        <input id="autoMonitorRuns" type="checkbox" checked />
        <span>Auto monitor queued command completion</span>
      </label>
      <div id="runMonitorStatus" class="hint">Run monitor idle.</div>
      <div class="inline-actions wrap">
        <button id="stopRunMonitorButton" class="secondary" disabled>Stop Monitor</button>
        <button id="showMonitorFailuresButton" class="secondary" disabled>Show Last Failures</button>
        <button id="retryMonitorFailuresButton" class="secondary" disabled>Retry Last Failures</button>
        <button id="exportRunMonitorButton" class="secondary" disabled>Export Monitor Report</button>
        <button id="clearRunMonitorSessionButton" class="secondary" disabled>Clear Monitor Session</button>
      </div>
      <h3>Run Monitor History</h3>
      <div class="inline-actions wrap">
        <select id="runMonitorHistorySelect">
          <option value="">No run monitor history</option>
        </select>
      </div>
      <div class="inline-actions">
        <button id="loadRunMonitorHistoryButton" class="secondary" disabled>Load History Session</button>
        <button id="exportRunMonitorHistoryButton" class="secondary" disabled>Export History Session</button>
        <button id="clearRunMonitorHistoryButton" class="secondary" disabled>Clear History</button>
      </div>
      <div id="runMonitorHistoryStatus" class="hint">No run monitor history yet.</div>
      <div id="voiceStatus" class="hint">Voice input idle.</div>
      <div class="hint">
        Voice shortcuts: say "nova command smart run ...", "nova command plan ...", "nova command run ...", "nova command run template", "nova command guided check", "nova command show failures", "nova command retry failures", "nova command load last history", "nova command export last history", or "nova command clear history".
      </div>
      <div class="hint">
        Keyboard shortcuts in prompt box: Cmd/Ctrl+Enter = Smart Run, Cmd/Ctrl+Shift+Enter = Plan Only, Alt+Enter = Run Template.
      </div>
    </section>

    <section class="grid">
      <article class="card">
        <h2>Generated Plan</h2>
        <div id="planSummary" class="hint">No plan generated yet.</div>
        <ol id="planCommands" class="plan-list"></ol>
      </article>

      <article class="card">
        <h2>Execution Result</h2>
        <div id="runSummary" class="hint">No commands queued in this session yet.</div>
        <ol id="queuedCommands" class="plan-list"></ol>
      </article>
    </section>

    <section class="card">
      <h2>Recent Bridge Commands</h2>
      <div class="inline-actions">
        <select id="recentStatusFilter">
          <option value="">All statuses</option>
          <option value="queued">Queued</option>
          <option value="dispatched">Dispatched</option>
          <option value="succeeded">Succeeded</option>
          <option value="failed">Failed</option>
          <option value="canceled">Canceled</option>
        </select>
        <button id="retryFailedButton" class="secondary">Retry Failed</button>
        <button id="cancelPendingButton" class="secondary">Cancel Pending Queue</button>
      </div>
      <div class="inline-actions wrap">
        <input id="recentRouteFilter" type="text" placeholder="Filter route (contains)" autocomplete="off" />
        <input id="recentActionFilter" type="text" placeholder="Filter action (contains)" autocomplete="off" />
        <input id="recentClientFilter" type="text" placeholder="Filter client (contains)" autocomplete="off" />
      </div>
      <div class="inline-actions">
        <button id="applyRecentFiltersButton" class="secondary">Apply Filters</button>
        <button id="clearRecentFiltersButton" class="secondary">Clear Filters</button>
        <button id="exportRecentButton" class="secondary">Export Filtered JSON</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Route</th>
            <th>Action</th>
            <th>Status</th>
            <th>Client</th>
            <th>Controls</th>
          </tr>
        </thead>
        <tbody id="recentTableBody"></tbody>
      </table>
      <h3>Live Event Feed</h3>
      <ul id="streamEvents" class="event-feed"></ul>
    </section>
  </main>

  <script src="/nova4d/studio/assets/app.js"></script>
</body>
</html>
